<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: boardRender.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: boardRender.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// @ts-check
/* global firebase */
/// &lt;reference path="./boardTypesD.ts" />

/**
 * Board-Rendering &amp; Interaktion (Karten, DnD, Suche, Mobile-Move-Menü).
 * Exportiert unter `window.Board.Render`.
 */
(function (w) {
  /** @type {any} */ const Win = (w);
  Win.Board = Win.Board || {};
  /** @type {any} */ const Assigned = (Win.Board.Assigned);

  /** @typedef {"todo"|"inprogress"|"awaitingfeedback"|"done"} TaskStatus */
  /** @typedef {"urgent"|"medium"|"low"} TaskPriority */
  /** @typedef {{title:string,done:boolean}} Subtask */
  /** @typedef {{ id:string, title?:string, description?:string, category?:string, dueDate?:string, priority?:TaskPriority, status:TaskStatus, assignedTo?:string[]|string, subtasks?:Subtask[] }} Task */

  const COLS  = /** @type {Record&lt;TaskStatus,string>} */ ({ todo:'toDo', inprogress:'inProgress', awaitingfeedback:'awaitFeedback', done:'done' });
  const ORDER = /** @type {TaskStatus[]} */ (['todo','inprogress','awaitingfeedback','done']);
  const LABEL = /** @type {Record&lt;TaskStatus,string>} */ ({ todo:'To-do', inprogress:'In progress', awaitingfeedback:'Review', done:'Done' });

  /** @type {Task[]} */ let tasks = [];
  /** @type {string|null} */ let draggedTaskId = null;

  // ───────────────────────────────────────────────────────────────
  // Move-Menü (Singleton)
  // ───────────────────────────────────────────────────────────────
  /** @type {HTMLDivElement|null} */ let menuEl = null;

  /** @returns {TaskStatus|null} */
  function adjacent(st, dir) {
    const i = ORDER.indexOf(st); if (i &lt; 0) return null;
    return dir === 'up' ? (i > 0 ? ORDER[i - 1] : null) : (i &lt; ORDER.length - 1 ? ORDER[i + 1] : null);
  }

  /** @returns {void} */
  function moveTaskToStatus(id, st) {
    if (!st) return;
    firebase.database().ref('tasks/' + id + '/status').set(st);
  }

  /** @returns {HTMLDivElement} */
  function getMenu() {
    if (menuEl) return menuEl;
    menuEl = createMenuEl();
    wireOutsideClose(menuEl);
    return menuEl;
  }

  /** @returns {HTMLDivElement} */
  function createMenuEl() {
    const el = document.createElement('div');
    el.className = 'move-menu'; el.style.display = 'none';
    el.innerHTML = `
      &lt;h5>Move to&lt;/h5>
      &lt;div class="item item-up">&lt;span class="arrow">↑&lt;/span>&lt;span class="label-up">&lt;/span>&lt;/div>
      &lt;div class="item item-down">&lt;span class="arrow">↓&lt;/span>&lt;span class="label-down">&lt;/span>&lt;/div>`;
    document.body.appendChild(el);
    return el;
  }

  /** @returns {void} */
  function wireOutsideClose(el) {
    document.addEventListener('click', (e) => {
      if (el.style.display === 'none') return;
      if (!(e.target instanceof Node)) return;
      if (!el.contains(e.target)) el.style.display = 'none';
    });
  }

  /** @returns {void} */
  function positionMenu(el, r) {
    el.style.left = Math.min(window.innerWidth - 180, r.right + 8) + 'px';
    el.style.top  = Math.max(8, r.top) + 'px';
    el.style.display = 'block';
  }

  /** @returns {void} */
  function setMoveLabels(el, up, dn) {
    (/** @type {HTMLSpanElement} */ (el.querySelector('.label-up'))).textContent   = up ? LABEL[up] : '';
    (/** @type {HTMLSpanElement} */ (el.querySelector('.label-down'))).textContent = dn ? LABEL[dn] : '';
  }

  /** @returns {void} */
  function setItemState(n, enabled) {
    n.style.opacity = enabled ? '1' : '.35';
    n.style.pointerEvents = enabled ? 'auto' : 'none';
    n.style.display = enabled ? 'flex' : 'none';
  }

  /** @returns {void} */
  function enableDisableItems(el, up, dn) {
    const upI = /** @type {HTMLDivElement} */ (el.querySelector('.item-up'));
    const dnI = /** @type {HTMLDivElement} */ (el.querySelector('.item-down'));
    setItemState(upI, !!up); setItemState(dnI, !!dn);
    upI.replaceWith(upI.cloneNode(true)); dnI.replaceWith(dnI.cloneNode(true));
  }

  /** @returns {void} */
  function bindMoveClicks(el, task, up, dn) {
    if (up) (/** @type {HTMLDivElement} */ (el.querySelector('.item-up')))
      .addEventListener('click', () => { moveTaskToStatus(task.id, up); el.style.display = 'none'; });
    if (dn) (/** @type {HTMLDivElement} */ (el.querySelector('.item-down')))
      .addEventListener('click', () => { moveTaskToStatus(task.id, dn); el.style.display = 'none'; });
  }

  /** @returns {void} */
  function showMoveMenuForCard(card, task) {
    const el = getMenu(); positionMenu(el, card.getBoundingClientRect());
    const up = adjacent(task.status, 'up'); const dn = adjacent(task.status, 'down');
    setMoveLabels(el, up, dn); enableDisableItems(el, up, dn); bindMoveClicks(el, task, up, dn);
  }

  // ───────────────────────────────────────────────────────────────
  // Render
  // ───────────────────────────────────────────────────────────────
  /** @returns {void} */
  function clearColumns() {
    Object.values(COLS).forEach(id => {
      const col = /** @type {HTMLDivElement} */ (document.getElementById(id));
      if (col) col.innerHTML = '';
    });
  }

  /** @returns {void} */
  function mountCards(arr) {
    arr.forEach(t => {
      const mount = document.getElementById(COLS[t.status]);
      if (mount) mount.appendChild(createTaskCard(t));
    });
  }

  /** @returns {void} */
  function showEmptyPlaceholders(arr) {
    Object.entries(COLS).forEach(([st, id]) => {
      const any = arr.some(t => t.status === /** @type {TaskStatus} */ (st));
      if (!any) {
        const col = document.getElementById(id);
        if (col) col.innerHTML = `&lt;div class="notask">No tasks ${st.replace(/^\w/, c => c.toUpperCase())}&lt;/div>`;
      }
    });
  }

  /**
   * @param {Task[]} arr
   * @returns {void}
   */
  function renderBoard(arr) {
    clearColumns();
    mountCards(arr);
    showEmptyPlaceholders(arr);
  }

  // ───────────────────────────────────────────────────────────────
  // Karten
  // ───────────────────────────────────────────────────────────────
  /** @param {string=} category */ function getCategoryHeaderClass(category) {
    const c = (category || "").toLowerCase();
    if (c.includes("bug")) return "task-header bug-task";
    if (c.includes("user")) return "task-header user-task";
    if (c.includes("tech")) return "task-header tech-task";
    if (c.includes("research")) return "task-header research-task";
    return "task-header";
  }

  /** @param {Task} task */ function calcProgress(task) {
    const total = Array.isArray(task.subtasks) ? task.subtasks.length : 0;
    const done  = Array.isArray(task.subtasks) ? task.subtasks.filter(s => s.done).length : 0;
    return { total, done, percent: total ? Math.round((done / total) * 100) : 0 };
  }

  /** @param {Task} task */ function prioIconFor(task) {
    /** @type {Record&lt;TaskPriority,string>} */ const map = { urgent:'prio_top', medium:'prio_mid', low:'prio_low' };
    return map[task.priority || 'medium'] || 'prio_mid';
  }

  /** @param {(string[]|string|undefined)} a */ function normalizeAssigned(a) {
    return Array.isArray(a) ? a.filter(Boolean).map(String) : (a ? [String(a)] : []);
  }

  /** @param {Task} task */ function badgesHtml(task) {
    const ids = normalizeAssigned(task.assignedTo); const vis = ids.slice(0, 4); const over = ids.length - vis.length;
    const base = vis.map(id => Assigned?.getProfileBadge?.(id) || '').join('');
    return base + (over > 0 ? `&lt;span class="profile-badge more-badge" title="+${over} more">+${over}&lt;/span>` : '');
  }

  /** @param {{total:number,done:number,percent:number}} p */ function subBarHtml(p) {
    if (!(p.total > 0 &amp;&amp; p.done > 0)) return '';
    return `
      &lt;div class="task-bar">
        &lt;div class="bar-wrapper">
          &lt;div class="progress-bar">&lt;span class="progress-bar-fill" style="width:${p.percent}%">&lt;/span>&lt;/div>
        &lt;/div>
        &lt;span class="sub-task">${p.done}/${p.total} Subtasks&lt;/span>
      &lt;/div>`;
  }

  /** @param {Task} task */ function buildCardEl(task) {
    const prioIcon = prioIconFor(task); const p = calcProgress(task);
    const card = document.createElement('div'); card.className = 'task';
    const headerClass = getCategoryHeaderClass(task.category || "");
    card.innerHTML = `
      &lt;span class="${headerClass}">${task.category || ""}&lt;/span>
      &lt;h4 class="task-title">${task.title || ""}&lt;/h4>
      &lt;p class="task-info">${task.description || ""}&lt;/p>
      ${subBarHtml(p)}
      &lt;div class="task-status">
        &lt;div>${badgesHtml(task)}&lt;/div>
        &lt;img class="prio-icon" src="../assets/icons/board/prio/${prioIcon}.svg" alt="">
      &lt;/div>`;
    return card;
  }

  /** @param {HTMLElement} card @param {Task} task */ function wireMoveBtn(card, task) {
    const btn = document.createElement('button');
    btn.className = 'mobile-move-btn'; btn.type = 'button';
    btn.innerHTML = `&lt;img src="../assets/icons/board/switch.png" alt="">`;
    btn.addEventListener('click', (e) => { e.stopPropagation(); showMoveMenuForCard(card, task); });
    card.appendChild(btn);
  }

  /** @param {HTMLElement} card */ function wireDrag(card) {
    card.setAttribute('draggable', 'true');
    card.addEventListener('dragstart', function () {
      draggedTaskId = this.getAttribute('data-task-id'); setTimeout(() => this.classList.add('dragging'), 0);
    });
    card.addEventListener('dragend', function () {
      draggedTaskId = null; this.classList.remove('dragging');
    });
  }

  /** @param {HTMLElement} card @param {Task} task */ function wireDetail(card, task) {
    card.addEventListener('click', () => (/** @type {any} */ (Win.Board?.Detail))?.openTaskDetail?.(task));
    card.addEventListener('contextmenu', (e) => { e.preventDefault(); showMoveMenuForCard(card, task); });
  }

  /**
   * @param {Task} task
   * @returns {HTMLDivElement}
   */
  function createTaskCard(task) {
    const card = buildCardEl(task);
    card.dataset.taskId = task.id;
    wireMoveBtn(card, task); wireDrag(card); wireDetail(card, task);
    return /** @type {HTMLDivElement} */ (card);
  }

  // ───────────────────────────────────────────────────────────────
  // Drop-Ziele
  // ───────────────────────────────────────────────────────────────
  /** @param {HTMLDivElement} el */ function onDragOver(el) { el.addEventListener('dragover', e => e.preventDefault()); }

  /** @param {HTMLDivElement} el */ function onDrop(el) {
    el.addEventListener('drop', function (e) {
      e.preventDefault(); this.classList.remove('drop-target'); if (!draggedTaskId) return;
      /** @type {Record&lt;string, TaskStatus>} */ const map = { toDo:'todo', inProgress:'inprogress', awaitFeedback:'awaitingfeedback', done:'done' };
      const st = map[this.id]; if (st) moveTaskToStatus(draggedTaskId, st);
    });
  }

  /** @param {HTMLDivElement} el */ function onDragEnter(el) {
    el.addEventListener('dragenter', function () { this.classList.add('drop-target'); });
  }

  /** @param {HTMLDivElement} el */ function onDragLeave(el) {
    el.addEventListener('dragleave', function () { this.classList.remove('drop-target'); });
  }

  /** @returns {void} */
  function initDropZoneById(id) {
    const el = /** @type {HTMLDivElement|null} */ (document.getElementById(id));
    if (!el) return; onDragOver(el); onDrop(el); onDragEnter(el); onDragLeave(el);
  }

  ['toDo', 'inProgress', 'awaitFeedback', 'done'].forEach(initDropZoneById);

  // ───────────────────────────────────────────────────────────────
  // Suche &amp; Stream
  // ───────────────────────────────────────────────────────────────
  /** @param {string} v */ function searchTasks(v) {
    const q = v.trim().toLowerCase();
    const f = t => (t.title || '').toLowerCase().includes(q) || (t.description || '').toLowerCase().includes(q);
    renderBoard(q ? tasks.filter(f) : tasks);
  }

  /** @returns {void} */
  function wireSearchInputs() {
    const q1 = /** @type {HTMLInputElement|null} */ (document.getElementById('taskSearch'));
    const q2 = /** @type {HTMLInputElement|null} */ (document.getElementById('taskSearchMobile'));
    if (q1) q1.addEventListener('input', e => searchTasks((/** @type {HTMLInputElement} */ (e.currentTarget)).value));
    if (q2) q2.addEventListener('input', e => searchTasks((/** @type {HTMLInputElement} */ (e.currentTarget)).value));
  }

  /** @returns {void} */
  function watchTasks() {
    firebase.database().ref('tasks').on('value', s => {
      const obj = /** @type {Record&lt;string, any>|null} */ (s.val()) || {};
      tasks = Object.values(obj); renderBoard(tasks);
    });
  }

  /** @returns {void} */
  function startTasksStream() {
    watchTasks(); wireSearchInputs();
  }

  // ───────────────────────────────────────────────────────────────
  // Export
  // ───────────────────────────────────────────────────────────────
  Win.Board.Render = { renderBoard, startTasksStream, showMoveMenuForCard };
})(window);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addContactLocally">addContactLocally</a></li><li><a href="global.html#addContacts">addContacts</a></li><li><a href="global.html#addNewContact">addNewContact</a></li><li><a href="global.html#addUsers">addUsers</a></li><li><a href="global.html#allInputsValid">allInputsValid</a></li><li><a href="global.html#animateContactDetails">animateContactDetails</a></li><li><a href="global.html#animateOverlayOut">animateOverlayOut</a></li><li><a href="global.html#checkLoadingScreen">checkLoadingScreen</a></li><li><a href="global.html#clearAddContactInputs">clearAddContactInputs</a></li><li><a href="global.html#clearTaskAssignment">clearTaskAssignment</a></li><li><a href="global.html#closeContactOptions">closeContactOptions</a></li><li><a href="global.html#closeOverlay">closeOverlay</a></li><li><a href="global.html#collectUpdatedFormData">collectUpdatedFormData</a></li><li><a href="global.html#confirmLockIcon">confirmLockIcon</a></li><li><a href="global.html#createContactGroup">createContactGroup</a></li><li><a href="global.html#createDivider">createDivider</a></li><li><a href="global.html#createInitialIcon">createInitialIcon</a></li><li><a href="global.html#createSuccessOverlay">createSuccessOverlay</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactFromEdit">deleteContactFromEdit</a></li><li><a href="global.html#deleteContactFromEditMobile">deleteContactFromEditMobile</a></li><li><a href="global.html#deleteContactFromFirebase">deleteContactFromFirebase</a></li><li><a href="global.html#deleteData">deleteData</a></li><li><a href="global.html#deleteMobileContact">deleteMobileContact</a></li><li><a href="global.html#doPasswordsMatch">doPasswordsMatch</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#editMobileContact">editMobileContact</a></li><li><a href="global.html#editOverlayDesktop">editOverlayDesktop</a></li><li><a href="global.html#editOverlayLogic">editOverlayLogic</a></li><li><a href="global.html#editOverlayMobile">editOverlayMobile</a></li><li><a href="global.html#editValidationInitialized">editValidationInitialized</a></li><li><a href="global.html#ensureOwnContactInList">ensureOwnContactInList</a></li><li><a href="global.html#errorMsgs">errorMsgs</a></li><li><a href="global.html#fillEditForm">fillEditForm</a></li><li><a href="global.html#finalizeContactDeletion">finalizeContactDeletion</a></li><li><a href="global.html#focusOnNewContact">focusOnNewContact</a></li><li><a href="global.html#getColorFromName">getColorFromName</a></li><li><a href="global.html#getContactById">getContactById</a></li><li><a href="global.html#getContactDetailsTemplate">getContactDetailsTemplate</a></li><li><a href="global.html#getContactTemplateByData">getContactTemplateByData</a></li><li><a href="global.html#getErrorMessages">getErrorMessages</a></li><li><a href="global.html#getFormData">getFormData</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getRegexes">getRegexes</a></li><li><a href="global.html#goBack">goBack</a></li><li><a href="global.html#groupContactsByInitial">groupContactsByInitial</a></li><li><a href="global.html#handleContactClick">handleContactClick</a></li><li><a href="global.html#hideContactDetails">hideContactDetails</a></li><li><a href="global.html#highlightAndScrollTo">highlightAndScrollTo</a></li><li><a href="global.html#isEmailValid">isEmailValid</a></li><li><a href="global.html#isOwnContact">isOwnContact</a></li><li><a href="global.html#isPasswordValid">isPasswordValid</a></li><li><a href="global.html#loadAllTasksFromFirebase">loadAllTasksFromFirebase</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#logOutUser">logOutUser</a></li><li><a href="global.html#nameValidation">nameValidation</a></li><li><a href="global.html#onloadFunction">onloadFunction</a></li><li><a href="global.html#openContactOptions">openContactOptions</a></li><li><a href="global.html#openContactOverview">openContactOverview</a></li><li><a href="global.html#openOverlay">openOverlay</a></li><li><a href="global.html#outsideOverlayClick">outsideOverlayClick</a></li><li><a href="global.html#passwordLockIcon">passwordLockIcon</a></li><li><a href="global.html#passwordVisibility">passwordVisibility</a></li><li><a href="global.html#postData">postData</a></li><li><a href="global.html#prepareContactSwitch">prepareContactSwitch</a></li><li><a href="global.html#putData">putData</a></li><li><a href="global.html#regexes">regexes</a></li><li><a href="global.html#removeContactFromLocalArray">removeContactFromLocalArray</a></li><li><a href="global.html#removeIdFromTaskArray">removeIdFromTaskArray</a></li><li><a href="global.html#renderAllContacts">renderAllContacts</a></li><li><a href="global.html#renderContactDetails">renderContactDetails</a></li><li><a href="global.html#rerenderContactList">rerenderContactList</a></li><li><a href="global.html#resetContactOverview">resetContactOverview</a></li><li><a href="global.html#saveAsUser">saveAsUser</a></li><li><a href="global.html#saveContactToFirebase">saveContactToFirebase</a></li><li><a href="global.html#setCurrentUser">setCurrentUser</a></li><li><a href="global.html#setupEditValidation">setupEditValidation</a></li><li><a href="global.html#setupFormSubmit">setupFormSubmit</a></li><li><a href="global.html#setupInputListeners">setupInputListeners</a></li><li><a href="global.html#setupInputSanitizers">setupInputSanitizers</a></li><li><a href="global.html#setupSanitizers">setupSanitizers</a></li><li><a href="global.html#setupValidation">setupValidation</a></li><li><a href="global.html#setupValidationListeners">setupValidationListeners</a></li><li><a href="global.html#showDetails">showDetails</a></li><li><a href="global.html#showLoadingScreen">showLoadingScreen</a></li><li><a href="global.html#showOverlay">showOverlay</a></li><li><a href="global.html#showSuccessOverlay">showSuccessOverlay</a></li><li><a href="global.html#signUpUser">signUpUser</a></li><li><a href="global.html#submitSignUpForm">submitSignUpForm</a></li><li><a href="global.html#toggleSubmit">toggleSubmit</a></li><li><a href="global.html#toggleSubmitState">toggleSubmitState</a></li><li><a href="global.html#updateContactInFirebase">updateContactInFirebase</a></li><li><a href="global.html#updateFormStyles">updateFormStyles</a></li><li><a href="global.html#updateLocalContact">updateLocalContact</a></li><li><a href="global.html#updateTaskAssignedTo">updateTaskAssignedTo</a></li><li><a href="global.html#updateTasksAssignedToContact">updateTasksAssignedToContact</a></li><li><a href="global.html#userLogIn">userLogIn</a></li><li><a href="global.html#validateEmailInput">validateEmailInput</a></li><li><a href="global.html#validateForm">validateForm</a></li><li><a href="global.html#validateInput">validateInput</a></li><li><a href="global.html#validatePassword">validatePassword</a></li><li><a href="global.html#validateSpecificInput">validateSpecificInput</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Oct 05 2025 17:59:52 GMT+0200 (Mitteleuropäische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
